# Product Service Configuration
nameOverride: "product-service"

# ServiceAccount Configuration
serviceAccount:
  enabled: true
  name: product-service-sa
  annotations: {}

# Deployment Configuration
deployment:
  enabled: true
  replicaCount: 1
  image:
    repository: 767397883134.dkr.ecr.eu-west-1.amazonaws.com/microservices-product
    tag: latest
    pullPolicy: IfNotPresent
  service:
    port: 5001
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  livenessProbe:
    httpGet:
      path: /products
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
  readinessProbe:
    httpGet:
      path: /products
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
  startupProbe:
    httpGet:
      path: /products
      port: http
    failureThreshold: 30
    periodSeconds: 10
  env:
    - name: PORT
      value: "5001"
    - name: NODE_ENV
      value: "test"

# Service Configuration
service:
  enabled: true
  type: ClusterIP
  port: 5001
  targetPort: 5001
  annotations: {}

# Autoscaling Configuration
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Image Configuration
image:
  registry: 767397883134.dkr.ecr.eu-west-1.amazonaws.com
  name: microservices-product
  tag: 93247c4c92511f2da9eb3c7f85df1109434c5852
  pullPolicy: IfNotPresent

# Ingress Configuration
ingress:
  enabled: true
  name: "product-service-ingress"
  className: "alb"
  annotations:
    "scheme": "internet-facing"
    "targetType": "instance"
    "healthcheckPath": "/products/"
    "healthcheckProtocol": "HTTP"
    "successCodes": "200"
    "healthyThresholdCount": "2"
    "unhealthyThresholdCount": "2"
    "groupName": "platform-test-eks"
    "groupOrder": "1"
    "certificateArn": "arn:aws:acm:eu-west-1:767397883134:certificate/c8fdbfe8-a678-4055-8e4e-a48183f105af"
    "alb.ingress.kubernetes.io/subnets": "subnet-053e498fd0658cdc7,subnet-0dbae47b2c6ae837d,subnet-005d492791e368ed1"
    "alb.ingress.kubernetes.io/security-groups": "sg-0624528efa18ffdda,sg-007a7c57f68e812fd"
    "alb.ingress.kubernetes.io/target-type": "instance"
    "alb.ingress.kubernetes.io/listen-ports": '[{"HTTP": 80}, {"HTTPS": 443}]'
    "alb.ingress.kubernetes.io/ssl-redirect": "443"
    "alb.ingress.kubernetes.io/load-balancer-attributes": "routing.http.drop_invalid_header_fields.enabled=true"
    "alb.ingress.kubernetes.io/actions.ssl-redirect": '{"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301"}}'
  hosts:
    - host: microservices.platform-online.shop
      paths:
        - path: /products
          pathType: Prefix
          service: product-service
          port: 80

# NetworkPolicy Configuration
networkPolicy:
  enabled: true
  name: "product-service-network-policy"
  ingressRules:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: user-service
      ports:
        - protocol: TCP
          port: 5001

# PodDisruptionBudget Configuration
podDisruptionBudget:
  enabled: true
  name: "product-service-pdb"
  minAvailable: 1

# ResourceQuota Configuration
resourceQuota:
  enabled: true
  name: "product-service-quota"
  hard:
    requests.cpu: "2"
    requests.memory: 2Gi
    limits.cpu: "4"
    limits.memory: 4Gi
    pods: "10"
